# Настройка базы данных

## Требования
- PostgreSQL 15 или выше
- Пользователь с правами на создание баз данных

## Пошаговая настройка

### 1. Создание базы данных

```sql
-- Подключитесь к PostgreSQL как суперпользователь
psql -U postgres

-- Создайте базу данных
CREATE DATABASE cartridge_db;

-- Подключитесь к созданной базе данных
\c cartridge_db;

-- Проверьте подключение
\dt
```

### 2. Настройка пользователя (опционально)

```sql
-- Создайте отдельного пользователя для приложения
CREATE USER cartridge_user WITH PASSWORD 'secure_password';

-- Предоставьте права на базу данных
GRANT ALL PRIVILEGES ON DATABASE cartridge_db TO cartridge_user;

-- Подключитесь как новый пользователь
\c cartridge_db cartridge_user
```

### 3. Создание таблиц

**Вариант A: Автоматическое создание через JPA (рекомендуется)**
- Приложение автоматически создаст таблицы при первом запуске
- Убедитесь, что в `application.yml` установлено: `ddl-auto: update`

**Вариант B: Ручное создание таблиц**
```sql
-- Выполните скрипт schema.sql
\i src/main/resources/schema.sql
```

### 4. Настройка приложения

Обновите `src/main/resources/application.yml`:

```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/cartridge_db
    username: postgres  # или cartridge_user
    password: your_password
```

### 5. Запуск приложения

```bash
./gradlew bootRun
```

Приложение автоматически:
- Создаст таблицы (если их нет)
- Вставит тестовые данные из `data.sql`

## Тестовые данные

После запуска в базе будут созданы:

### Пользователи:
- **admin** / **admin123** - Администратор
- **warehouse** / **warehouse123** - Складской работник  
- **user1** / **user123** - Пользователь объекта

### Объекты:
- Главный склад
- Офис №1
- Филиал №2

### Картриджи:
- HP 26A (на складе)
- HP 49A (на складе)
- Canon 043 (в использовании)
- Epson 101 (на заправке)
- Brother TN-660 (списан)

### Операции:
- История операций с картриджами

## Проверка настройки

1. **Подключитесь к базе данных:**
   ```bash
   psql -U postgres -d cartridge_db
   ```

2. **Проверьте таблицы:**
   ```sql
   \dt
   ```

3. **Проверьте данные:**
   ```sql
   SELECT * FROM users;
   SELECT * FROM locations;
   SELECT * FROM cartridges;
   SELECT * FROM operations;
   ```

4. **Проверьте API:**
   - Откройте http://localhost:8080/swagger-ui.html
   - Попробуйте войти с тестовыми учетными данными

## Устранение проблем

### Ошибка подключения к базе данных:
- Проверьте, что PostgreSQL запущен
- Проверьте настройки в `application.yml`
- Убедитесь, что база данных создана

### Ошибка создания таблиц:
- Проверьте права пользователя
- Проверьте настройки JPA в `application.yml`

### Ошибка вставки данных:
- Проверьте, что таблицы созданы
- Проверьте синтаксис в `data.sql` 